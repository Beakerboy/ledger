<?php

/**
 * @file
 * Ledger
 */

/**
 * Include code for the entity types and callbacks.
 */
module_load_include('inc', 'ledger', 'includes/ledger.account');
module_load_include('inc', 'ledger', 'includes/ledger.transaction');
module_load_include('inc', 'ledger', 'includes/callbacks');

/**
 * Implements hook_entity_info().
 */
function ledger_entity_info() {
  $entities['ledger_account'] = array(
    'label' => t('Ledger Account'),
    'entity class' => 'LedgerAccount',
    'controller class' => 'LedgerAccountController',
    'base table' => 'ledger_account',
    'fieldable' => TRUE,
    'entity keys' => array(
      'id' => 'aid',
    ),
    'label callback' => 'entity_class_label',
    'uri callback' => 'entity_class_uri',
    'module' => 'ledger',
  );
  $entities['ledger_transaction'] = array(
    'label' => t('Ledger Transaction'),
    'entity class' => 'LedgerTransaction',
    'controller class' => 'LedgerTransactionController',
    'base table' => 'ledger_transaction',
    'fieldable' => TRUE,
    'entity keys' => array(
      'id' => 'tid',
    ),
    'label callback' => 'entity_class_label',
    'uri callback' => 'entity_class_uri',
    'module' => 'ledger',
  );
  return $entities;
}

/**
 * Implementation of hook_permission().
 *
 * @todo
 *   Add fine-tuned permissions for viewing and editing individual accounts. ie:
 *     view any accounts
 *     edit any accounts
 *     delete any accounts
 *     view own accounts
 *     edit own accounts
 *     delete own accounts
 */
function ledger_permission() {
  return array(
    'administer ledger' => array(
      'title' => t('Administer Ledger'), 
      'description' => t('Administer all ledger accounts and transactions.'),
    ),
  );
}

/**
 * Implementation of hook_views_api().
 */
function ledger_views_api() {
  return array(
    'api' => 3,
    'path' => drupal_get_path('module', 'ledger') . '/includes/views',
  );
}

/**
 * Returns an initialized account object.
 *
 * @return
 *   An account object with all default fields initialized.
 */
function ledger_account_new($values = array()) {
  return entity_get_controller('ledger_account')->create($values);
}